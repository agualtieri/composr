---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",echo = TRUE
    
)
```

```{r, include=F}
library(composr)
library(dplyr)
df<-data.frame(select_one_letters=sample(letters,500,T),
               some_numbers=runif(500)*20,
               id=1:500,
               select_multiple_letters = sapply(1:500,function(x){
                 sample(LETTERS,round(runif(1,min = 1,max = 10)),T) %>% paste(collapse=" ")
                 }))
df<-lapply(df,function(x){x[sample(1:length(x), 100)]<-NA; x}) %>% as_tibble
```

# Test data

For illustration, here's a simple test data frame:

```{r}
df

```

# Recoding


First, you start a recoding, and name the source and the target variable (the source variable must exist in the dataset, and the target variable must _not_ yet exist in the data set).
Recoding then happens through consecutive conditions. For each condition, you supply a value to be used if the condition is fulfilled.
If more than one condition is fulfilled for the same data row / value in the source variable, the value for the last condition that was added is used. Rows for which no condition is fullfilled default to `NA`.

A simple example with numbers. We start a new recoding, specifying the source and target variables:
```{r,results='hold'}

df %>%
  new_recoding(source = "some_numbers",
               target = "positive_or_negative") 


```

This already creates the new variable.


```{r,results='asis'}

 
df_with_recoded_var <- df %>%
  
  new_recoding(source = "some_numbers",
               target = "positive_or_negative") %>% 
  
  recode_to("positive",
            where.num.larger = 0) 

(function(){cat("HALLO")})()
df_with_recoded_var
```


```{r}

df %>%
  
  new_recoding(source = "some_numbers",
               target = "larger_10") %>% 
  
  recode_to("big number",
            where.num.larger = 10) %>% 
  
  
  recode_to("small number",
            where.num.smaller.equal = 10)


```

<!-- df_with_recoding <- df %>% -->
<!--   new_recoding(source = "select_multiple_var","alphabet_groups") %>% -->
<!--   # recode_to("contains A-F",where.selected.any = c("A", "B", "C", "D", "E", "F"),otherwise.to = "no A-F at all") %>%  -->
<!--   recode_to("a single Q and nothing else!",where.selected.exactly = "Q")  -->

<!-- # %>%  -->
<!--   # recode_to("final letters present",where.selected.all = c("Y","Z")) -->

<!--   compose_select_multiple_any("a_variable",from=letters[1:24],to="7",otherwise = "X")  -->

<!-- df_with_composite <- df_with_composite %>% new_composition(composition_name = "is_cv1_7") %>% -->

<!--   compose_select_multiple_any(variable = "my_composite_variable",from = "7",to = TRUE) %>% -->
<!--   compose_default("a_variable") -->
<!--   compose_select_multiple_any(variable = "my_composite_variable",from = "2",to = FALSE) %>%  -->
<!--   new_composition("chained_composition") %>%  -->
<!--   compose_select_multiple_any(variable="is_cv1_7",from=TRUE, to = FALSE) -->





<!-- print(df_with_composite) -->


<!-- df %>% new_composition("mynewcomp") -->


